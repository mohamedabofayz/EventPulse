<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SmartHotel AI - Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Sans-serif:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<style>
:root {
--dark-blue: #0A2E5A;
--green: #27AE60;
--orange: #F39C12;
--yellow: #F1C40F;
--red: #E74C3C;
--light-blue: #E8F4FD;
--gray: #6C757D;
--border: #dee2e6;
--card-bg: #ffffff;
--input-bg: #f8f9fa;
--modal-bg: #ffffff;
--text-main: #212529;
--text-muted: #6c757d;
--success: #28a745;
--danger: #dc3545;
--font-sans: 'Sans-serif', Arial, sans-serif;
/* Heatmap Colors */
--very-high: #e74c3c;
--high: #f39c12;
--medium: #f1c40f;
--neutral: #ffffff;
}
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
font-family: var(--font-sans);
background-color: #F0F4F8;
color: var(--text-main);
min-height: 100vh;
padding-bottom: 40px;
line-height: 1.6;
}
.container { max-width: 1400px; margin: 0 auto; padding: 20px; }
/* Header */
header { text-align: center; padding: 30px 20px; }
h1 {
font-size: clamp(1.8rem, 4vw, 3rem);
color: var(--dark-blue);
font-weight: 800;
margin-bottom: 10px;
}
/* Panels */
.glass-panel {
background: var(--card-bg);
box-shadow: 0 4px 20px rgba(0,0,0,0.05);
border: 1px solid white;
border-radius: 16px;
padding: clamp(15px, 3vw, 30px);
margin-bottom: 30px;
}
.room-summary-panel {
margin-top: 20px;
display: none;
}
.room-type-card {
background: var(--light-blue);
border-radius: 12px;
padding: 15px;
text-align: center;
border-top: 3px solid var(--dark-blue);
}
.room-type-name {
font-weight: 700;
color: var(--dark-blue);
font-size: 1.1rem;
margin-bottom: 5px;
}
.room-type-count {
font-size: 1.8rem;
font-weight: 800;
color: var(--dark-blue);
margin: 8px 0;
}
.room-type-percent {
color: var(--gray);
font-size: 0.9rem;
}
.form-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
}
.form-group label {
display: block;
margin-bottom: 8px;
color: var(--dark-blue);
font-weight: 600;
font-size: 0.9rem;
}
input, select {
width: 100%;
background: var(--input-bg);
border: 1px solid var(--border);
color: var(--text-main);
padding: 10px 15px;
border-radius: 8px;
font-family: inherit;
font-size: 0.95rem;
}
input:focus, select:focus {
border-color: var(--dark-blue);
outline: none;
box-shadow: 0 0 0 3px rgba(10, 46, 90, 0.1);
}
/* Room Types */
.room-type-row {
display: grid;
grid-template-columns: 2fr 1fr auto;
gap: 15px;
margin-bottom: 10px;
background: var(--light-blue);
padding: 10px;
border-radius: 8px;
align-items: center;
}
/* Buttons */
.btn {
cursor: pointer;
padding: 12px 20px;
border-radius: 8px;
border: none;
font-weight: 700;
transition: all 0.3s ease;
display: inline-flex;
align-items: center;
justify-content: center;
gap: 8px;
font-family: var(--font-sans);
font-size: 1rem;
}
.btn-primary {
background: var(--dark-blue);
color: white;
width: 100%;
margin-top: 20px;
box-shadow: 0 4px 15px rgba(10, 46, 90, 0.3);
}
.btn-primary:hover {
background: #082348;
transform: translateY(-2px);
}
.btn-danger {
background: #fff; color: var(--danger); width: 35px; height: 35px; border: 1px solid #ffccd0; padding: 0;
}
.btn-success {
background: var(--green); color: white; width: auto; font-size: 0.9rem; padding: 8px 15px; margin-top: 10px;
}
.btn-loading {
opacity: 0.7;
pointer-events: none;
}
/* Floating Settings Button */
.settings-fab {
position: fixed;
right: 30px;
bottom: 30px;
width: 65px;
height: 65px;
background: var(--dark-blue);
color: white;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 30px;
box-shadow: 0 5px 20px rgba(0,0,0,0.3);
cursor: pointer;
z-index: 999;
transition: transform 0.3s;
border: 2px solid white;
}
.settings-fab:hover { transform: rotate(45deg) scale(1.1); }
.settings-fab::after {
content: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª';
position: absolute;
right: 75px;
background: #333;
color: white;
padding: 5px 10px;
border-radius: 5px;
font-size: 14px;
opacity: 0;
pointer-events: none;
transition: opacity 0.3s;
white-space: nowrap;
}
.settings-fab:hover::after { opacity: 1; }
/* Dashboard Stats */
.dashboard-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
gap: 20px;
margin-bottom: 30px;
}
.room-types-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 15px;
margin-top: 15px;
}
.stat-card {
background: var(--card-bg);
padding: 20px;
border-radius: 16px;
box-shadow: 0 2px 10px rgba(0,0,0,0.05);
border-top: 4px solid var(--dark-blue);
}
.stat-value {
font-size: 1.8rem; font-weight: 800; color: var(--dark-blue); margin: 8px 0;
}
.stat-label {
color: var(--text-muted); font-size: 0.9rem; font-weight: 600;
}
.profit-badge {
background: rgba(39, 174, 96, 0.1); padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; display: inline-block; margin-top: 8px;
}
/* Calendar */
.month-grid {
display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;
}
.month-card {
background: var(--card-bg); border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
.month-header {
background: var(--dark-blue); padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; color: white; font-weight: 600; cursor: pointer;
}
.days-container {
display: grid; grid-template-columns: repeat(7, 1fr); padding: 10px; gap: 3px; background: #fff;
}
.day-cell {
aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 0.85rem; cursor: pointer; transition: 0.2s; position: relative;
}
.day-cell:hover { transform: scale(1.1); z-index: 2; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
/* Heatmap Classes */
.heat-very-high { background-color: var(--very-high); color: white; }
.heat-high { background-color: var(--high); color: white; }
.heat-medium { background-color: var(--medium); color: #212529; }
.heat-neutral { background-color: #f8f9fa; color: #aaa; border: 1px solid #eee; }
/* Toggle Switch */
.switch-container {
display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee;
}
.switch {
position: relative; display: inline-block; width: 46px; height: 24px;
}
.switch input { opacity: 0; width: 0; height: 0; }
.slider {
position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px;
}
.slider:before {
position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;
}
input:checked + .slider { background-color: var(--green); }
input:checked + .slider:before { transform: translateX(22px); }
/* Modals */
.modal {
position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 2000; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s;
}
.modal.active { opacity: 1; pointer-events: all; }
.modal-content {
background: white; width: 90%; max-width: 900px; max-height: 90vh; overflow-y: auto; padding: 30px; border-radius: 16px; box-shadow: 0 20px 50px rgba(0,0,0,0.2);
}
.settings-section { margin-bottom: 20px; }
.settings-section h3 { color: var(--dark-blue); border-bottom: 2px solid #eee; padding-bottom: 8px; margin-bottom: 15px; }
/* Table */
table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9rem; }
th, td { padding: 12px; text-align: right; border-bottom: 1px solid #eee; }
th { background: var(--light-blue); color: var(--dark-blue); position: sticky; top: 0; }
.hidden { display: none !important; }
.fade-in { animation: fadeIn 0.6s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
/* Strategies Footer */
#strategiesFooter {
margin-top: 30px;
padding: 25px;
}
.strategies-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
gap: 25px;
margin-top: 20px;
}
.strategy-card {
background: var(--light-blue);
padding: 20px;
border-radius: 12px;
border-left: 4px solid var(--dark-blue);
transition: transform 0.3s ease;
}
.strategy-card:hover {
transform: translateY(-3px);
box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}
.strategy-card h3 {
color: var(--dark-blue);
margin-bottom: 10px;
font-size: 1.2rem;
display: flex;
align-items: center;
gap: 10px;
}
.strategy-card h3::before {
content: "âœ“";
color: var(--green);
font-weight: bold;
font-size: 1.1rem;
}
.strategy-card p {
color: var(--text-muted);
line-height: 1.6;
font-size: 0.95rem;
}
.strategy-badge {
display: inline-block;
background: rgba(10, 46, 90, 0.1);
color: var(--dark-blue);
padding: 3px 8px;
border-radius: 4px;
font-size: 0.8rem;
margin-top: 8px;
}
/* Heatmap Legend */
.heatmap-legend {
display: flex;
justify-content: center;
gap: 15px;
margin: 20px 0;
padding: 15px;
background: var(--light-blue);
border-radius: 12px;
}
.legend-item {
display: flex;
flex-direction: column;
align-items: center;
min-width: 80px;
}
.legend-color {
width: 40px;
height: 20px;
border-radius: 4px;
margin-bottom: 5px;
}
.legend-label {
font-size: 0.85rem;
color: var(--text-muted);
font-weight: 500;
}
.heat-very-high { background-color: var(--very-high); }
.heat-high { background-color: var(--high); }
.heat-medium { background-color: var(--medium); }
.heat-neutral { background-color: #f8f9fa; border: 1px solid #eee; }
/* Responsive */
@media (max-width: 768px) {
.form-grid { grid-template-columns: 1fr; }
.room-type-row { grid-template-columns: 1fr 1fr auto; }
.room-types-grid { grid-template-columns: 1fr; }
.strategies-container { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
<div class="container">
<header>
<h1>SmartHotel AI</h1>
<p style="color: var(--gray);">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</p>
</header>
<div class="glass-panel fade-in">
<h2 style="margin-bottom: 20px; color: var(--dark-blue);">ğŸ“„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙ†Ø¯Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
<form id="hotelForm">
<div class="form-grid">
<div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„ÙÙ†Ø¯Ù‚</label><input type="text" id="hotelName" value="ÙÙ†Ø¯Ù‚ Ø§Ù„Ø­Ø±Ù… 2026"></div>
<div class="form-group"><label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
<select id="provinceSelect">
    <option value="" disabled selected>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚...</option>
</select>
</div>
<div class="form-group"><label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºØ±Ù</label><input type="number" id="totalRooms" value="150"></div>
<div class="form-group"><label>ØºØ±Ù Ù…Ø·Ù„Ø©</label><input type="number" id="viewRooms" value="45"></div>
<div class="form-group"><label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø±ÙŠØ§Ù„)</label><input type="number" id="basePrice" value="450"></div>
<div class="form-group"><label>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø³Ù†ÙˆÙŠ</label><input type="number" id="annualRent" value="6000000"></div>
<div class="form-group"><label>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ %</label><input type="number" id="currentProfitMargin" value="12"></div>
</div>
<h3 style="margin: 20px 0 10px; font-size: 1rem; color: var(--dark-blue);">Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØºØ±Ù</h3>
<div id="roomTypesContainer">
<div class="room-type-row">
<input type="text" class="rt-name" value="ØºØ±ÙØ© Ù…Ø²Ø¯ÙˆØ¬Ø©" placeholder="Ø§Ù„Ù†ÙˆØ¹">
<input type="number" class="rt-count" value="100" placeholder="Ø§Ù„Ø¹Ø¯Ø¯">
<button type="button" class="btn btn-danger remove-rt">Ã—</button>
</div>
<div class="room-type-row">
<input type="text" class="rt-name" value="Ø¬Ù†Ø§Ø­ Ù…Ù„ÙƒÙŠ" placeholder="Ø§Ù„Ù†ÙˆØ¹">
<input type="number" class="rt-count" value="50" placeholder="Ø§Ù„Ø¹Ø¯Ø¯">
<button type="button" class="btn btn-danger remove-rt">Ã—</button>
</div>
</div>
<button type="button" class="btn btn-success" id="addRoomBtn">+ Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹</button>
<button type="submit" class="btn btn-primary" id="analyzeBtn">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¬Ù„Ø¨ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</button>
</form>
</div>

<div class="glass-panel room-summary-panel fade-in" id="roomSummaryPanel">
<h2 style="margin-bottom: 20px; color: var(--dark-blue);">ğŸ¨ ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØºØ±Ù ÙÙŠ Ø§Ù„ÙÙ†Ø¯Ù‚</h2>
<div class="room-types-grid" id="roomTypesSummary"></div>
</div>

<div id="resultsArea" class="hidden fade-in">
<div class="dashboard-grid">
<div class="stat-card">
<div class="stat-label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div>
<div class="stat-value" id="totalRevenueDisplay">0</div>
<div class="profit-badge" id="revBoostBadge" style="background:#e0f2fe; color:var(--dark-blue)"></div>
</div>
<div class="stat-card">
<div class="stat-label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div>
<div class="stat-value" style="color: var(--green);" id="netProfitDisplay">0</div>
</div>
<div class="stat-card">
<div class="stat-label">Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¬Ø¯ÙŠØ¯</div>
<div class="stat-value" id="newMarginDisplay">0%</div>
<div class="profit-badge" id="marginImprovement"></div>
</div>
<div class="stat-card">
<div class="stat-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø´ØºØ§Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ</div>
<div class="stat-value" id="occupancyDisplay">0%</div>
<div class="stat-label" style="font-size:0.8rem; color:var(--orange)">Ù…Ø­Ø³Ù† Ø¨ÙˆØ§Ø³Ø·Ø© Min Stay AI</div>
</div>
</div>
<div class="heatmap-legend">
<div class="legend-item">
<div class="legend-color heat-very-high"></div>
<span class="legend-label">Ø°Ø±ÙˆØ© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹</span>
</div>
<div class="legend-item">
<div class="legend-color heat-high"></div>
<span class="legend-label">Ø°Ø±ÙˆØ© Ø¹Ø§Ù„ÙŠØ©</span>
</div>
<div class="legend-item">
<div class="legend-color heat-medium"></div>
<span class="legend-label">Ø°Ø±ÙˆØ© Ù…ØªÙˆØ³Ø·Ø©</span>
</div>
<div class="legend-item">
<div class="legend-color heat-neutral"></div>
<span class="legend-label">Ø¹Ø§Ø¯ÙŠ</span>
</div>
</div>
<div style="text-align: left; margin: 20px 0;">
<button class="btn btn-success" id="exportBtn" style="width: auto;">ğŸ“¥ ØªØµØ¯ÙŠØ± Excel Ø´Ø§Ù…Ù„</button>
</div>
<div class="month-grid" id="calendarGrid"></div>
</div>
<div id="strategiesFooter" class="glass-panel hidden fade-in">
<h2 style="margin-bottom: 20px; color: var(--dark-blue); display: flex; align-items: center; gap: 10px;">
<span>ğŸ“Š Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©</span>
<span class="strategy-badge">Ù…ÙØ­Ø³Ù‘Ù† Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</span>
</h2>
<div class="strategies-container" id="strategiesContainer"></div>
</div>
</div>
<div class="settings-fab" onclick="openSettings()">âš™ï¸</div>
<div class="modal" id="settingsModal">
<div class="modal-content">
<div style="display:flex; justify-content:space-between; margin-bottom:20px;">
<h2 style="color:var(--dark-blue)">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</h2>
<button class="btn btn-danger" onclick="closeModal('settingsModal')">Ã—</button>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
<div class="settings-section">
<h3>1. Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ± (Pricing)</h3>
<div class="switch-container">
<div>
<strong>Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…Ø¨ÙƒØ± (Early Booking)</strong>
<div style="font-size:0.8rem; color:#777">Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙÙŠ Ø±Ù…Ø¶Ø§Ù†/Ø­Ø¬ Ø¨Ù†Ø³Ø¨Ø© 35-45%</div>
</div>
<label class="switch"><input type="checkbox" id="st_early" checked><span class="slider"></span></label>
</div>
<div class="switch-container">
<div>
<strong>Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ (Dynamic)</strong>
<div style="font-size:0.8rem; color:#777">ØªØ¹Ø¯ÙŠÙ„ ÙŠÙˆÙ…ÙŠ + Premium Events (ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³/Ø§Ù„ÙˆØ·Ù†ÙŠ)</div>
</div>
<label class="switch"><input type="checkbox" id="st_dynamic" checked><span class="slider"></span></label>
</div>
<div class="switch-container">
<div>
<strong>ØªØ³Ø¹ÙŠØ± Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Event-Specific)</strong>
<div style="font-size:0.8rem; color:#777">Ø²ÙŠØ§Ø¯Ø© 40% Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙƒØ¨Ø±Ù‰ (ÙÙˆØ±Ù…ÙˆÙ„Ø§/Ù…Ø¤ØªÙ…Ø±Ø§Øª)</div>
</div>
<label class="switch"><input type="checkbox" id="st_event" checked><span class="slider"></span></label>
</div>
</div>
<div class="settings-section">
<h3>2. ØªØ¹Ø¸ÙŠÙ… Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Boosters)</h3>
<div class="switch-container">
<div>
<strong>Ø­Ø²Ù… Ø§Ù„ØªØ±Ù‚ÙŠØ© (Upselling)</strong>
<div style="font-size:0.8rem; color:#777">Ø¥Ø¶Ø§ÙØ© ÙˆØ¬Ø¨Ø§Øª/Ù†Ù‚Ù„ (+6% ADR)</div>
</div>
<label class="switch"><input type="checkbox" id="st_upsell" checked><span class="slider"></span></label>
</div>
<div class="switch-container">
<div>
<strong>Ø­Ø²Ù… Ø§Ù„Ø´Ø±ÙƒØ§Øª (Corporate)</strong>
<div style="font-size:0.8rem; color:#777">Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ø¤ØªÙ…Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ø§Ø±Ø¶ (+20%)</div>
</div>
<label class="switch"><input type="checkbox" id="st_corp"><span class="slider"></span></label>
</div>
<div class="switch-container">
<div>
<strong>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¥Ù‚Ø§Ù…Ø© (Min Stay)</strong>
<div style="font-size:0.8rem; color:#777">ÙØ±Ø¶ Ù„ÙŠÙ„ØªÙŠÙ† ÙÙŠ Ø§Ù„Ø°Ø±ÙˆØ© (Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø´ØºØ§Ù„)</div>
</div>
<label class="switch"><input type="checkbox" id="st_minstay" checked><span class="slider"></span></label>
</div>
</div>
</div>
<div class="settings-section" style="margin-top:20px;">
<h3>3. Ù…Ø¶Ø§Ø¹ÙØ§Øª Ø§Ù„Ù…ÙˆØ§Ø³Ù… (Multipliers)</h3>
<div class="form-grid" style="background:#f8f9fa; padding:15px; border-radius:10px;">
<div class="form-group">
<label>Ø±Ù…Ø¶Ø§Ù† (%)</label>
<input type="number" id="mul_ramadan" value="250">
</div>
<div class="form-group">
<label>Ø§Ù„Ø¹Ø´Ø± Ø§Ù„Ø£ÙˆØ§Ø®Ø± (%)</label>
<input type="number" id="mul_last10" value="400">
</div>
<div class="form-group">
<label>Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬ (%)</label>
<input type="number" id="mul_hajj" value="450">
</div>
<div class="form-group">
<label>Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (%)</label>
<input type="number" id="mul_weekend" value="130">
</div>
</div>
</div>
<button class="btn btn-primary" onclick="applySettings()">ğŸ’¾ Ø­ÙØ¸ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
</div>
</div>
<div class="modal" id="detailsModal">
<div class="modal-content">
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
<h3 id="detailsTitle"></h3>
<button class="btn btn-danger" onclick="closeModal('detailsModal')">Ã—</button>
</div>
<div class="table-responsive" style="overflow-x:auto;">
<table id="detailsTable">
<thead id="detailsHead"></thead>
<tbody id="detailsBody"></tbody>
</table>
</div>
</div>
</div>
<script>
// --- Configuration & State ---
// >>> Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ Webhook Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§ <<<
const GAS_WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbzBTVYM8eOSXNsbF2HDnOkdwKKdLuF_K9Df4Egn0BvgRRcc212HlUHONg_FlIn7Mw1v/exec"; 

const state = {
hotelInfo: {},
roomTypes: [],
yearlyData: [],
fetchedEvents: [], // ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ù…Ù† Ø§Ù„Ù€ Webhook
strategies: {
earlyBooking: true,
dynamicPricing: true,
eventPricing: true,
upselling: true,
corporate: false,
minStay: true
},
multipliers: {
ramadan: 2.5,
lastTen: 4.0,
hajj: 4.5,
weekend: 1.3
}
};
// Strategy information mapping
const strategyInfo = {
earlyBooking: {
name: "Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…Ø¨ÙƒØ±",
desc: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ù†Ø³Ø¨Ø© 35-45% ÙÙŠ Ù…ÙˆØ§Ø³Ù… Ø§Ù„Ø°Ø±ÙˆØ© (Ø±Ù…Ø¶Ø§Ù†ØŒ Ø§Ù„Ø­Ø¬) Ù„ØªØ­ÙÙŠØ² Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¨ÙƒØ±Ø© ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª. ÙŠØ·Ø¨Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§ÙƒØªØ´Ø§Ù Ù…ÙˆØ§Ø³Ù… Ø§Ù„Ø°Ø±ÙˆØ©."
},
dynamicPricing: {
name: "Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ",
desc: "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø·Ù„Ø¨ Ù…Ø¹ Ø²ÙŠØ§Ø¯Ø§Øª Ø®Ø§ØµØ© Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙˆØ·Ù†ÙŠØ© (ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³ØŒ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ). ÙŠØ³ØªØ®Ø¯Ù… Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù„ÙŠ Ù„Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø·Ù„Ø¨."
},
eventPricing: {
name: "ØªØ³Ø¹ÙŠØ± Ø§Ù„Ø£Ø­Ø¯Ø§Ø«",
desc: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ù†Ø³Ø¨Ø© 40% Ø®Ù„Ø§Ù„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„ÙƒØ¨Ø±Ù‰ (ÙÙˆØ±Ù…ÙˆÙ„Ø§ 1ØŒ Ø§Ù„Ù…Ø¤ØªÙ…Ø±Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©) Ù„ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‚ØµÙ‰ Ø±Ø¨Ø­ Ù…Ù† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø®Ø§ØµØ©. ÙŠØªØ¶Ù…Ù† ÙƒØ´Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø£Ø­Ø¯Ø§Ø«."
},
upselling: {
name: "Ø­Ø²Ù… Ø§Ù„ØªØ±Ù‚ÙŠØ©",
desc: "Ø¹Ø±Ø¶ Ø®Ø¯Ù…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (ÙˆØ¬Ø¨Ø§Øª ÙØ§Ø®Ø±Ø©ØŒ Ù†Ù‚Ù„ Ø®Ø§Øµ) Ù„Ø²ÙŠØ§Ø¯Ø© Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„ØºØ±ÙØ© Ø§Ù„ÙŠÙˆÙ…ÙŠ (ADR) Ø¨Ù†Ø³Ø¨Ø© 6%. ÙŠØ¸Ù‡Ø± Ù„Ø¶ÙŠÙˆÙ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…Ø¨ÙƒØ± ÙƒØ®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©."
},
corporate: {
name: "Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø´Ø±ÙƒØ§Øª",
desc: "Ø®ØµÙˆÙ…Ø§Øª Ù…Ù…ÙŠØ²Ø© Ù„Ù„Ø´Ø±ÙƒØ§Øª ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª (Ù…Ø«Ù„ Ø§Ù„Ù…Ø¹Ø§Ø±Ø¶) Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©. ÙŠØ´Ù…Ù„ Ø¹Ù‚ÙˆØ¯Ø§Ù‹ Ø³Ù†ÙˆÙŠØ© Ø¨Ù…Ø±ÙˆÙ†Ø© ÙÙŠ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±."
},
minStay: {
name: "Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¥Ù‚Ø§Ù…Ø©",
desc: "ÙØ±Ø¶ Ø¥Ù‚Ø§Ù…Ø© Ù„ÙŠÙ„ØªÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙÙŠ Ù…ÙˆØ§Ø³Ù… Ø§Ù„Ø°Ø±ÙˆØ© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø´ØºØ§Ù„ ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª. ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø© Ø§Ù„ØªÙŠ ØªÙ‚Ù„Ù„ Ø§Ù„Ø±Ø¨Ø­ÙŠØ©."
}
};
const monthsAr = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
// Key Dates for 2026 (Approximate)
const events2026 = {
foundingDay: new Date(2026, 1, 22), // Feb 22
nationalDay: new Date(2026, 8, 23), // Sep 23
ramadanStart: new Date(2026, 1, 18),
lastTenStart: new Date(2026, 2, 9),
ramadanEnd: new Date(2026, 2, 19),
hajjStart: new Date(2026, 4, 15),
hajjEnd: new Date(2026, 4, 25),
// Adding specific prompt events adapted for simulation
summerFest: { start: new Date(2026, 6, 1), end: new Date(2026, 7, 30) }, // July-Aug
corporateSeason: { start: new Date(2026, 9, 1), end: new Date(2026, 9, 15) } // Oct (Construct Expo equivalent)
};
// --- Event Listeners ---
document.addEventListener('DOMContentLoaded', () => {
    fetchProvincesFromGAS(); // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
});

document.getElementById('addRoomBtn').addEventListener('click', () => {
const div = document.createElement('div');
div.className = 'room-type-row';
div.innerHTML = `<input type="text" class="rt-name" placeholder="Ø§Ù„Ù†ÙˆØ¹"><input type="number" class="rt-count" placeholder="Ø§Ù„Ø¹Ø¯Ø¯"><button type="button" class="btn btn-danger remove-rt">Ã—</button>`;
document.getElementById('roomTypesContainer').appendChild(div);
});
document.getElementById('roomTypesContainer').addEventListener('click', e => {
if(e.target.classList.contains('remove-rt')) e.target.parentElement.remove();
});
document.getElementById('hotelForm').addEventListener('submit', async e => {
e.preventDefault();
await handleAnalysis(); // Changed to Async Handler
});
document.getElementById('exportBtn').addEventListener('click', exportExcel);
function openSettings() { document.getElementById('settingsModal').classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }
function applySettings() {
// Update Strategies from Toggle Switches
state.strategies.earlyBooking = document.getElementById('st_early').checked;
state.strategies.dynamicPricing = document.getElementById('st_dynamic').checked;
state.strategies.eventPricing = document.getElementById('st_event').checked;
state.strategies.upselling = document.getElementById('st_upsell').checked;
state.strategies.corporate = document.getElementById('st_corp').checked;
state.strategies.minStay = document.getElementById('st_minstay').checked;
// Update Multipliers
state.multipliers.ramadan = Number(document.getElementById('mul_ramadan').value) / 100;
state.multipliers.lastTen = Number(document.getElementById('mul_last10').value) / 100;
state.multipliers.hajj = Number(document.getElementById('mul_hajj').value) / 100;
state.multipliers.weekend = Number(document.getElementById('mul_weekend').value) / 100;
closeModal('settingsModal');
runAnalysis(); // Re-run analysis with new settings
}

// --- NEW: Webhook Integration for Provinces & Events ---

// 1. Fetch Provinces List on Load
async function fetchProvincesFromGAS() {
    const provinceSelect = document.getElementById('provinceSelect');
    
    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø±Ø§Ø¨Ø· Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    if (GAS_WEBHOOK_URL.includes("YOUR_SCRIPT_URL") || GAS_WEBHOOK_URL === "") {
        // Ø§Ù„Ø§Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ HTML (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)
        return;
    }

    try {
        // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ù„Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª: ?action=getProvinces
        const response = await fetch(`${GAS_WEBHOOK_URL}?action=getProvinces`);
        if (!response.ok) throw new Error("Webhook Error");
        const provinces = await response.json();
        
        // Ø¥Ø°Ø§ Ø¹Ø§Ø¯Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…ØµÙÙˆÙØ©ØŒ Ù†Ù‚ÙˆÙ… Ø¨ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        if (Array.isArray(provinces) && provinces.length > 0) {
            provinceSelect.innerHTML = ''; // Ù…Ø³Ø­ "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„"
            provinces.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø©
                opt.textContent = p; // Ø§Ù„Ù†Øµ Ø§Ù„Ø¸Ø§Ù‡Ø±
                provinceSelect.appendChild(opt);
            });
        }
    } catch (e) {
        console.warn("Could not fetch provinces from Webhook, using defaults.", e);
        // ÙÙŠ Ø­Ø§Ù„ Ø§Ù„ÙØ´Ù„ØŒ Ù†Ø¹ÙŠØ¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‚Ø¯ Ù…Ø³Ø­Øª
        if (provinceSelect.options.length <= 1) {
            provinceSelect.innerHTML = `
                <option value="Makkah">Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©</option>
                <option value="Madinah">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©</option>
                <option value="Riyadh">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                <option value="Eastern">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</option>
                <option value="Asir">Ø¹Ø³ÙŠØ±</option>
            `;
        }
    }
}

// 2. Main Analysis Handler
async function handleAnalysis() {
    const btn = document.getElementById('analyzeBtn');
    const originalText = btn.textContent;
    btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®ÙˆØ§Ø¯Ù…...';
    btn.classList.add('btn-loading');

    const province = document.getElementById('provinceSelect').value;
    
    try {
        await fetchProvinceEvents(province);
    } catch (err) {
        console.error("Webhook Error or Offline:", err);
    } finally {
        runAnalysis();
        btn.textContent = originalText;
        btn.classList.remove('btn-loading');
    }
}

// 3. Fetch Events for Selected Province
async function fetchProvinceEvents(province) {
    if (GAS_WEBHOOK_URL.includes("YOUR_SCRIPT_URL")) {
        console.log("No actual Webhook URL provided. Skipping fetch.");
        state.fetchedEvents = simulateEvents(province);
        return;
    }

    try {
        // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«: ?action=getEvents&province=X
        const url = `${GAS_WEBHOOK_URL}?action=getEvents&province=${encodeURIComponent(province)}`;
        const response = await fetch(url);
        if (!response.ok) throw new Error("Network response was not ok");
        const data = await response.json();
        // Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: [{ name: "Event Name", date: "2026-10-20" }, ...]
        state.fetchedEvents = data;
    } catch (error) {
        console.warn("Using simulation due to fetch error:", error);
        state.fetchedEvents = simulateEvents(province);
    }
}


// --- Core Analysis Logic (UNCHANGED) ---
function runAnalysis() {
// 1. Get Form Data
state.hotelInfo = {
name: document.getElementById('hotelName').value,
province: document.getElementById('provinceSelect').value, // Store province
totalRooms: Number(document.getElementById('totalRooms').value),
viewRooms: Number(document.getElementById('viewRooms').value),
basePrice: Number(document.getElementById('basePrice').value),
rent: Number(document.getElementById('annualRent').value),
currentMargin: Number(document.getElementById('currentProfitMargin').value)
};
state.roomTypes = [];
document.querySelectorAll('.room-type-row').forEach(row => {
const name = row.querySelector('.rt-name').value;
const count = Number(row.querySelector('.rt-count').value);
if(name && count) state.roomTypes.push({ name, count });
});
if(state.roomTypes.length === 0) return alert('Ø£Ø¶Ù Ù†ÙˆØ¹ ØºØ±ÙØ© ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
// 2. Generate Data
state.yearlyData = generateData();
// 3. Render Room Summary
renderRoomSummary();
// 4. Render Dashboard
renderDashboard();
document.getElementById('resultsArea').classList.remove('hidden');
document.getElementById('strategiesFooter').classList.remove('hidden');
document.getElementById('roomSummaryPanel').classList.remove('hidden');
document.getElementById('roomSummaryPanel').classList.add('fade-in');
// Scroll to results
window.scrollTo({ top: document.getElementById('resultsArea').offsetTop - 50, behavior: 'smooth' });
}
function renderRoomSummary() {
const container = document.getElementById('roomTypesSummary');
container.innerHTML = '';
const totalRooms = state.hotelInfo.totalRooms;
state.roomTypes.forEach(room => {
const percentage = Math.round((room.count / totalRooms) * 100);
const roomCard = document.createElement('div');
roomCard.className = 'room-type-card';
roomCard.innerHTML = `
<div class="room-type-name">${room.name}</div>
<div class="room-type-count">${room.count}</div>
<div class="room-type-percent">${percentage}% Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºØ±Ù</div>
`;
container.appendChild(roomCard);
});
}
function generateData() {
const data = [];
const viewRatio = state.hotelInfo.viewRooms / state.hotelInfo.totalRooms;
for (let m = 0; m < 12; m++) {
const daysInMonth = new Date(2026, m + 1, 0).getDate();
for (let d = 1; d <= daysInMonth; d++) {
const date = new Date(2026, m, d);
const dayOfWeek = date.getDay();
const isWeekend = (dayOfWeek === 5 || dayOfWeek === 6);
let seasonName = "Ø¹Ø§Ø¯ÙŠ";
let baseMult = 1.0;
let activeStrategies = [];
// --- 1. Base Season Logic ---
if (date >= events2026.lastTenStart && date <= events2026.ramadanEnd) {
seasonName = "Ø§Ù„Ø¹Ø´Ø± Ø§Ù„Ø£ÙˆØ§Ø®Ø±";
baseMult = state.multipliers.lastTen;
} else if (date >= events2026.ramadanStart && date <= events2026.ramadanEnd) {
seasonName = "Ø±Ù…Ø¶Ø§Ù†";
baseMult = state.multipliers.ramadan;
} else if (date >= events2026.hajjStart && date <= events2026.hajjEnd) {
seasonName = "Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬";
baseMult = state.multipliers.hajj;
} else if (isWeekend) {
seasonName = "Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹";
baseMult = state.multipliers.weekend;
}
// --- 2. Apply Strategies ---
// Strategy: Early Booking (Boosts Peak Seasons)
if (state.strategies.earlyBooking && (seasonName.includes("Ø±Ù…Ø¶Ø§Ù†") || seasonName.includes("Ø§Ù„Ø­Ø¬"))) {
// Logic: Early booking secures higher average rate
baseMult += 0.35; // +35% impact
activeStrategies.push("earlyBooking");
}
// Strategy: Event Pricing (National Day / Founding Day / fetchedEvents)
if (state.strategies.eventPricing) {
if (date.getTime() === events2026.foundingDay.getTime()) {
seasonName = "ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³";
baseMult = Math.max(baseMult, 2.5);
activeStrategies.push("eventPricing");
}
if (date.getTime() === events2026.nationalDay.getTime()) {
seasonName = "Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ";
baseMult = Math.max(baseMult, 2.5);
activeStrategies.push("eventPricing");
}
// Check fetched events from Webhook
if (state.fetchedEvents && state.fetchedEvents.length > 0) {
    const fetchedMatch = state.fetchedEvents.find(ev => {
        const evDate = new Date(ev.date);
        return evDate.getDate() === d && evDate.getMonth() === m && evDate.getFullYear() === 2026;
    });
    if (fetchedMatch) {
        seasonName = fetchedMatch.name;
        baseMult = Math.max(baseMult, 2.5); // Treat like major event
        activeStrategies.push("eventPricing");
    }
}
}
// Strategy: Corporate (October Season)
if (state.strategies.corporate && date >= events2026.corporateSeason.start && date <= events2026.corporateSeason.end) {
if (baseMult < 1.5) { // Only boost if not already peak
baseMult = 1.3;
seasonName = "Ù…ÙˆØ³Ù… Ø£Ø¹Ù…Ø§Ù„";
activeStrategies.push("corporate");
}
}
// Strategy: Dynamic Pricing (Summer)
if (state.strategies.dynamicPricing && date >= events2026.summerFest.start && date <= events2026.summerFest.end) {
if (baseMult < 1.2) {
baseMult = 1.25; // Slight boost for Summer Fest
activeStrategies.push("dynamicPricing");
}
}
// --- 3. Calculate Occupancy & Revenue ---
// Base Occupancy
let occ = 55; // Standard
if (baseMult > 2.0) occ = 90;
else if (baseMult > 1.2) occ = 75;
// Strategy: Min Stay (Stabilize Occupancy in Peak)
if (state.strategies.minStay && baseMult > 2.0) {
occ = 98; // Force near full occupancy
activeStrategies.push("minStay");
}
// Strategy: Upselling (Add Value to Rate)
let upsellingValue = 0;
if (state.strategies.upselling) {
upsellingValue = state.hotelInfo.basePrice * 0.06; // +6% ADR
activeStrategies.push("upselling");
}
// Calculate Rooms
let dailyTotalRev = 0;
const roomDetails = state.roomTypes.map((rt, idx) => {
const typeBase = state.hotelInfo.basePrice * (1 + (idx * 0.4));
const finalRate = Math.round((typeBase * baseMult) + upsellingValue);
const viewCount = Math.round(rt.count * viewRatio);
const stdCount = rt.count - viewCount;
// View rooms get 30% extra premium
const viewRate = Math.round(finalRate * 1.3);
const rev = (stdCount * finalRate * (occ/100)) + (viewCount * viewRate * (occ/100));
dailyTotalRev += rev;
return { name: rt.name, count: rt.count, rate: finalRate, viewRate: viewRate, rev: rev };
});
data.push({
date: date,
monthIdx: m,
day: d,
season: seasonName,
mult: baseMult,
occ: occ,
strategies: activeStrategies,
rooms: roomDetails,
totalRev: Math.round(dailyTotalRev),
viewRoomsCount: state.hotelInfo.viewRooms // Added fixed view rooms count per day
});
}
}
return data;
}
function renderDashboard() {
// Stats
const totalRev = state.yearlyData.reduce((a, b) => a + b.totalRev, 0);
const rent = state.hotelInfo.rent;
const opsCost = totalRev * 0.22; // 22% Ops cost
const net = totalRev - rent - opsCost;
const margin = (net / totalRev) * 100;
document.getElementById('totalRevenueDisplay').textContent = (totalRev/1000000).toFixed(2) + " Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„";
document.getElementById('netProfitDisplay').textContent = (net/1000000).toFixed(2) + " Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„";
document.getElementById('newMarginDisplay').textContent = margin.toFixed(1) + "%";
const diff = margin - state.hotelInfo.currentMargin;
const badge = document.getElementById('marginImprovement');
badge.textContent = diff > 0 ? `ØªØ­Ø³Ù† +${diff.toFixed(1)}%` : `ØªØºÙŠØ± ${diff.toFixed(1)}%`;
badge.style.color = diff > 0 ? 'var(--green)' : 'var(--red)';
// Count Active Strategies for Badge
const activeCount = Object.values(state.strategies).filter(Boolean).length;
document.getElementById('revBoostBadge').textContent = `ØªÙ… ØªÙØ¹ÙŠÙ„ ${activeCount} Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø°ÙƒÙŠØ©`;
const avgOcc = state.yearlyData.reduce((a,b) => a + b.occ, 0) / 365;
document.getElementById('occupancyDisplay').textContent = Math.round(avgOcc) + "%";
// Calendar
const grid = document.getElementById('calendarGrid');
grid.innerHTML = '';
monthsAr.forEach((mName, mIdx) => {
const card = document.createElement('div');
card.className = 'month-card';
const header = document.createElement('div');
header.className = 'month-header';
header.innerHTML = `<span>${mName}</span><span>ğŸ‘ï¸</span>`;
header.onclick = () => showMonthDetails(mIdx);
const daysDiv = document.createElement('div');
daysDiv.className = 'days-container';
const days = state.yearlyData.filter(d => d.monthIdx === mIdx);
// Spacer for first day
const firstDay = days[0].date.getDay();
for(let i=0; i<firstDay; i++) {
const empty = document.createElement('div');
empty.style.opacity = '0.3';
daysDiv.appendChild(empty);
}
days.forEach(d => {
let heatClass = 'heat-neutral';
if(d.mult > 3.0) heatClass = 'heat-very-high';
else if(d.mult > 2.0) heatClass = 'heat-high';
else if(d.mult > 1.2) heatClass = 'heat-medium';
const cell = document.createElement('div');
cell.className = `day-cell ${heatClass}`;
cell.textContent = d.day;
// Add dot if strategy active
if(d.strategies.length > 0) {
const dot = document.createElement('div');
dot.style.cssText = 'width:5px;height:5px;background:var(--dark-blue);border-radius:50%;position:absolute;bottom:3px;right:3px;';
cell.appendChild(dot);
}
cell.title = `${d.season} | Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯: ${d.totalRev.toLocaleString()} Ø±ÙŠØ§Ù„ | Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª: ${d.strategies.map(s => strategyInfo[s].name).join(', ')}`;
cell.onclick = (e) => { e.stopPropagation(); showDayDetails(d); };
daysDiv.appendChild(cell);
});
card.appendChild(header);
card.appendChild(daysDiv);
grid.appendChild(card);
});
// Render Strategies Footer
renderStrategiesFooter();
}
function renderStrategiesFooter() {
const container = document.getElementById('strategiesContainer');
container.innerHTML = '';
const activeStrategies = Object.keys(state.strategies).filter(key => state.strategies[key]);
if (activeStrategies.length === 0) {
container.innerHTML = '<p class="text-muted" style="text-align:center; padding:20px; color:var(--gray);">Ù„Ù… ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø£ÙŠ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª. Ù‚Ù… Ø¨ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.</p>';
return;
}
activeStrategies.forEach(key => {
if (strategyInfo[key]) {
const strat = strategyInfo[key];
const card = document.createElement('div');
card.className = 'strategy-card';
card.innerHTML = `
<h3>${strat.name}</h3>
<p>${strat.desc}</p>
<div class="strategy-badge">Ù…ÙÙØ¹Ù‘Ù„</div>
`;
container.appendChild(card);
}
});
}
function showMonthDetails(mIdx) {
const days = state.yearlyData.filter(d => d.monthIdx === mIdx);
document.getElementById('detailsTitle').textContent = `ØªÙØ§ØµÙŠÙ„ Ø´Ù‡Ø± ${monthsAr[mIdx]}`;
let th = `<tr><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</th><th>Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª</th><th>Ø§Ù„Ø¥Ø´ØºØ§Ù„</th><th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</th><th>ØºØ±Ù Ù…Ø·Ù„Ø©</th></tr>`;
document.getElementById('detailsHead').innerHTML = th;
let tb = '';
days.forEach(d => {
const strategyNames = d.strategies.map(s => strategyInfo[s].name).join(', ') || '-';
tb += `<tr>
<td>${d.day}</td>
<td>${d.season}</td>
<td style="font-size:0.8rem; color:var(--gray)">${strategyNames}</td>
<td>${d.occ}%</td>
<td style="color:var(--green); font-weight:bold">${d.totalRev.toLocaleString()} Ø±ÙŠØ§Ù„</td>
<td>${d.viewRoomsCount}</td>
</tr>`;
});
document.getElementById('detailsBody').innerHTML = tb;
document.getElementById('detailsModal').classList.add('active');
}
function showDayDetails(d) {
document.getElementById('detailsTitle').textContent = `ØªÙØ§ØµÙŠÙ„ ÙŠÙˆÙ… ${d.day} ${monthsAr[d.monthIdx]}`;
let th = `<tr><th>Ù†ÙˆØ¹ Ø§Ù„ØºØ±ÙØ©</th><th>Ø§Ù„Ø¹Ø¯Ø¯</th><th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠ</th><th>Ø³Ø¹Ø± Ø§Ù„Ø¥Ø·Ù„Ø§Ù„Ø©</th><th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯</th><th>ØºØ±Ù Ù…Ø·Ù„Ø©</th></tr>`;
document.getElementById('detailsHead').innerHTML = th;
let tb = '';
d.rooms.forEach(r => {
const viewCount = Math.round(r.count * (state.hotelInfo.viewRooms / state.hotelInfo.totalRooms));
tb += `<tr>
<td>${r.name}</td>
<td>${r.count} ØºØ±ÙØ©</td>
<td>${r.rate.toLocaleString()} Ø±ÙŠØ§Ù„</td>
<td>${r.viewRate.toLocaleString()} Ø±ÙŠØ§Ù„</td>
<td style="color:var(--green); font-weight:bold">${r.rev.toLocaleString()} Ø±ÙŠØ§Ù„</td>
<td>${viewCount} ØºØ±ÙØ©</td>
</tr>`;
});
document.getElementById('detailsBody').innerHTML = tb;
document.getElementById('detailsModal').classList.add('active');
}
function exportExcel() {
const wb = XLSX.utils.book_new();
// Summary Sheet
const summary = [
["ØªÙ‚Ø±ÙŠØ± Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª SmartHotel 2026"],
["Ø§Ø³Ù… Ø§Ù„ÙÙ†Ø¯Ù‚", state.hotelInfo.name],
["Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©", state.hotelInfo.province],
["Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ù…ÙØ¹Ù„Ø©", Object.keys(state.strategies).filter(k => state.strategies[k]).join(", ")],
["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºØ±Ù", state.hotelInfo.totalRooms],
["ØºØ±Ù Ù…Ø·Ù„Ø©", state.hotelInfo.viewRooms],
["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯", document.getElementById('totalRevenueDisplay').textContent],
["ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­", document.getElementById('netProfitDisplay').textContent]
];
XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(summary), "Ø§Ù„Ù…Ù„Ø®Øµ");
// Room Types Sheet
const roomHeaders = ["Ù†ÙˆØ¹ Ø§Ù„ØºØ±ÙØ©", "Ø§Ù„Ø¹Ø¯Ø¯", "Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©", "Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù Ø§Ù„Ù…Ø·Ù„Ø©"];
const roomRows = state.roomTypes.map(rt => {
const viewCount = Math.round(rt.count * (state.hotelInfo.viewRooms / state.hotelInfo.totalRooms));
return [
rt.name,
rt.count,
((rt.count / state.hotelInfo.totalRooms) * 100).toFixed(1) + "%",
viewCount
];
});
XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet([roomHeaders, ...roomRows]), "ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØºØ±Ù");
// Data Sheet
const headers = ["Ø§Ù„ØªØ§Ø±ÙŠØ®", "Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©", "Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø³Ø¹Ø± %", "Ø§Ù„Ø¥Ø´ØºØ§Ù„ %", "Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù Ø§Ù„Ù…Ø·Ù„Ø©", "Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ"];
const rows = state.yearlyData.map(d => [
`${d.day}/${d.monthIdx+1}/2026`,
d.season,
d.strategies.map(s => strategyInfo[s].name).join(", "),
(d.mult * 100).toFixed(0) + "%",
d.occ + "%",
state.hotelInfo.viewRooms,
d.totalRev
]);
XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet([headers, ...rows]), "Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©");
// Daily Room Details Sheet
const roomDetailsHeaders = ["Ø§Ù„ØªØ§Ø±ÙŠØ®", "Ù†ÙˆØ¹ Ø§Ù„ØºØ±ÙØ©", "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºØ±Ù", "ØºØ±Ù Ø¹Ø§Ø¯ÙŠØ©", "ØºØ±Ù Ù…Ø·Ù„Ø©", "Ø³Ø¹Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©", "Ø³Ø¹Ø± Ø§Ù„Ù…Ø·Ù„Ø©", "Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯"];
const roomDetailsRows = [];
state.yearlyData.forEach(d => {
d.rooms.forEach(r => {
const viewCount = Math.round(r.count * (state.hotelInfo.viewRooms / state.hotelInfo.totalRooms));
const stdCount = r.count - viewCount;
roomDetailsRows.push([
`${d.day}/${d.monthIdx+1}/2026`,
r.name,
r.count,
stdCount,
viewCount,
r.rate.toLocaleString() + " Ø±ÙŠØ§Ù„",
r.viewRate.toLocaleString() + " Ø±ÙŠØ§Ù„",
r.rev.toLocaleString() + " Ø±ÙŠØ§Ù„"
]);
});
});
XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet([roomDetailsHeaders, ...roomDetailsRows]), "ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØºØ±Ù Ø§Ù„ÙŠÙˆÙ…ÙŠØ©");
XLSX.writeFile(wb, "SmartHotel_Strategies_2026.xlsx");
}
</script>
</body>
</html>

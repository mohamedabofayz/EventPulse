<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartHotel AI - Ù…ÙƒØ© ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø©</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <style>
        :root {
            --dark-blue: #0A2E5A;
            --green: #27AE60;
            --orange: #F39C12;
            --yellow: #F1C40F;
            --red: #E74C3C;
            --light-blue: #E8F4FD;
            --gray: #6C757D;
            --border: #dee2e6;
            --card-bg: #ffffff;
            --input-bg: #f8f9fa;
            --modal-bg: #ffffff;
            --text-main: #212529;
            --text-muted: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --font-sans: 'Cairo', Arial, sans-serif;
            
            /* Heatmap Colors - Exact Thermal Colors */
            --very-high: #e74c3c;
            --high: #f39c12;
            --medium: #f1c40f;
            --neutral: #ffffff;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: var(--font-sans);
            background-color: #FFFFFF;
            color: var(--text-main);
            min-height: 100vh;
            padding-bottom: 40px;
            line-height: 1.6;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        header { text-align: center; padding: 30px 20px; }
        h1 {
            font-size: clamp(1.8rem, 4vw, 3rem);
            color: var(--dark-blue);
            font-weight: 800;
            margin-bottom: 10px;
        }
        
        /* Panels */
        .glass-panel {
            background: var(--card-bg);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: clamp(15px, 3vw, 30px);
            margin-bottom: 30px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group label { 
            display: block; 
            margin-bottom: 8px; 
            color: var(--dark-blue); 
            font-weight: 600; 
            font-size: 0.95rem;
        }
        
        input {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 12px 15px;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
        }
        input:focus { 
            border-color: var(--dark-blue); 
            outline: none; 
            box-shadow: 0 0 0 3px rgba(10, 46, 90, 0.15);
        }

        /* Room Types */
        .room-type-row {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 15px;
            margin-bottom: 15px;
            background: var(--light-blue);
            padding: 12px;
            border-radius: 10px;
            align-items: center;
        }

        /* Buttons */
        .btn {
            cursor: pointer; 
            padding: 12px 20px; 
            border-radius: 8px; 
            border: none;
            font-weight: 700; 
            transition: all 0.3s ease;
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px;
            font-family: var(--font-sans);
            font-size: 1rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .btn-primary { 
            background: var(--dark-blue); 
            color: white; 
            width: 100%; 
            margin-top: 20px;
            border: 1px solid var(--dark-blue);
        }
        .btn-primary:hover { 
            background: #082348; 
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(10, 46, 90, 0.25);
        }
        .btn-danger { 
            background: #fff; 
            color: var(--danger); 
            width: 40px; 
            border: 1px solid var(--border);
            border-radius: 8px;
            font-weight: bold;
            padding: 0;
            height: 40px;
        }
        .btn-danger:hover {
            background: #ffebee;
            border-color: var(--danger);
            color: var(--danger);
        }
        .btn-success {
            background: var(--green);
            color: white;
            border: 1px solid var(--green);
            width: auto;
            font-size: 0.9rem;
            padding: 8px 15px;
            margin-top: 10px;
        }
        .btn-success:hover {
            background: #219653;
            transform: translateY(-1px);
        }

        /* Dashboard Stats */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-value { 
            font-size: 1.8rem; 
            font-weight: 800; 
            color: var(--dark-blue); 
            margin: 8px 0; 
        }
        .stat-label { 
            color: var(--text-muted); 
            font-size: 0.95rem; 
            font-weight: 600;
        }
        .profit-badge { 
            color: var(--green); 
            font-weight: bold; 
            background: rgba(39, 174, 96, 0.1); 
            padding: 4px 10px; 
            border-radius: 6px; 
            font-size: 0.9rem; 
            display: inline-block;
            margin-top: 8px;
            border: 1px solid rgba(39, 174, 96, 0.2);
        }

        /* Legend */
        .legend-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 25px 0;
            padding: 15px;
            background: var(--light-blue);
            border-radius: 12px;
            border: 1px solid #c3e0ff;
        }
        .legend-item { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-size: 0.95rem; 
            color: var(--dark-blue);
            font-weight: 500;
        }
        .dot { 
            width: 14px; 
            height: 14px; 
            border-radius: 50%; 
            border: 1px solid rgba(0,0,0,0.1);
        }

        /* Calendar */
        .month-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 25px; 
        }
        .month-card { 
            background: var(--card-bg); 
            border-radius: 14px; 
            overflow: hidden; 
            border: 1px solid var(--border);
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }
        .month-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.12);
        }
        
        .month-header {
            background: var(--dark-blue); 
            padding: 14px 20px;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            cursor: pointer; 
            transition: 0.2s;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }
        .month-header:hover { 
            background: #0d3a73; 
        }
        .month-header span:last-child {
            font-size: 0.9rem;
            background: rgba(255,255,255,0.2);
            padding: 3px 10px;
            border-radius: 12px;
        }

        .days-container { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            padding: 12px; 
            gap: 4px;
            background: #f8f9fa;
        }
        
        .day-cell {
            aspect-ratio: 1; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-radius: 8px; 
            font-size: 0.95rem; 
            cursor: pointer; 
            transition: all 0.2s;
            background: var(--neutral);
            border: 1px solid var(--border);
            font-weight: 500;
            position: relative;
            color: var(--text-main);
        }
        .day-cell:hover { 
            transform: scale(1.08); 
            z-index: 2; 
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 2px var(--dark-blue);
            color: var(--dark-blue);
        }

        /* Heatmap Color Classes - Strict Flat Colors Only */
        .heat-very-high { background-color: var(--very-high); color: white; }
        .heat-high { background-color: var(--high); color: white; }
        .heat-medium { background-color: var(--medium); color: #212529; }
        .heat-neutral { background-color: var(--neutral); color: var(--text-main); }
        
        /* Seasonal Day Classes */
        .day-ramadan { border: 2px solid #f39c12; }
        .day-last10 { border: 2px solid #e74c3c; }
        .day-hajj { border: 2px solid #c0392b; }
        .day-weekend { border: 2px solid #27ae60; }
        .day-umrah-peak { border: 2px solid #8e44ad; }
        .day-winter { border: 2px solid #3498db; }

        /* Modals & Tables */
        .modal {
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.7); 
            z-index: 1000;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            opacity: 0; 
            pointer-events: none; 
            transition: 0.3s;
        }
        .modal.active { 
            opacity: 1; 
            pointer-events: all; 
        }
        .modal-content { 
            background: var(--modal-bg); 
            width: 95%; 
            max-width: 1000px; 
            max-height: 90vh; 
            overflow-y: auto; 
            padding: 25px; 
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.25);
            border: 1px solid var(--border);
        }
        
        .table-responsive { 
            overflow-x: auto; 
            margin-top: 15px;
            border: 1px solid var(--border);
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            min-width: 600px; 
            font-size: 0.95rem;
        }
        th, td { 
            padding: 14px 12px; 
            text-align: right; 
            border-bottom: 1px solid var(--border); 
        }
        th { 
            background: var(--light-blue); 
            color: var(--dark-blue); 
            font-weight: 700;
            position: sticky;
            top: 0;
        }
        tr:hover td {
            background: rgba(231, 241, 255, 0.5);
        }
        
        .hidden { 
            display: none !important; 
        }
        .export-btn { 
            background: var(--green); 
            color: white; 
            margin-top: 20px; 
            width: auto; 
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            box-shadow: 0 3px 8px rgba(39, 174, 96, 0.3);
        }
        .export-btn:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.4);
        }

        .close-modal {
            background: #f1f3f5;
            border: 1px solid var(--border);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }
        .close-modal:hover {
            background: #e9ecef;
            color: var(--danger);
            transform: rotate(90deg);
        }

        @media (max-width: 768px) {
            .form-grid,
            .dashboard-grid,
            .month-grid {
                grid-template-columns: 1fr;
            }
            .room-type-row {
                grid-template-columns: 1fr 1fr auto;
            }
            .legend-container {
                flex-direction: column;
                align-items: center;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>SmartHotel AI</h1>
        <p style="color: var(--gray); font-size: 1.1rem; margin-top: 8px;">Ù†Ø¸Ø§Ù… ØªØ³Ø¹ÙŠØ± Ø°ÙƒÙŠ Ù„Ù…ÙˆØ§Ø³Ù… Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø© - ØªØ­Ù„ÙŠÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆØ§Øª</p>
    </header>

    <div class="glass-panel fade-in">
        <h2 style="margin-bottom: 15px; color: var(--dark-blue); font-size: 1.5rem; display: flex; align-items: center; gap: 10px;">
            <span>ğŸ“Š</span> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙ†Ø¯Ù‚ ÙˆØ§Ù„Ù…Ø§Ù„ÙŠØ©
        </h2>
        <form id="hotelForm">
            <div class="form-grid">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„ÙÙ†Ø¯Ù‚</label>
                    <input type="text" id="hotelName" value="ÙÙ†Ø¯Ù‚ Ø§Ù„Ø­Ø±Ù…">
                </div>
                <div class="form-group">
                    <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù</label>
                    <input type="number" id="totalRooms" value="100">
                </div>
                <div class="form-group">
                    <label>Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù Ø°Ø§Øª Ø§Ù„Ø¥Ø·Ù„Ø§Ù„Ø© (Ø§Ù„Ù…Ù‡Ù…Ø©)</label>
                    <input type="number" id="viewRooms" value="30" placeholder="Ø­Ø±Ù…/ÙƒØ¹Ø¨Ø©">
                </div>
                <div class="form-group">
                    <label>Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„Ù„ÙŠÙ„Ø© (Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙˆØ³Ù…)</label>
                    <input type="number" id="basePrice" value="400">
                </div>
                <div class="form-group">
                    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø³Ù†ÙˆÙŠ (Ø±ÙŠØ§Ù„)</label>
                    <input type="number" id="annualRent" value="5000000">
                </div>
                <div class="form-group">
                    <label>Ù†Ø³Ø¨Ø© ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠØ© (%)</label>
                    <input type="number" id="currentProfitMargin" value="15">
                </div>
                <div class="form-group">
                    <label>Year Ù„Ù„ØªØ­Ù„ÙŠÙ„</label>
                    <select id="analysisYear" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); font-family: inherit; font-size: 1rem;">
                        <option value="2026" selected>2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                    </select>
                </div>
            </div>

            <h3 style="margin: 20px 0 15px; font-size: 1.1rem; color: var(--dark-blue); font-weight: 700;">ØªÙˆØ²ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØºØ±Ù</h3>
            <div id="roomTypesContainer">
                <div class="room-type-row">
                    <input type="text" class="rt-name" value="ØºØ±ÙØ© Ø«Ù†Ø§Ø¦ÙŠØ©" placeholder="Ø§Ù„Ù†ÙˆØ¹">
                    <input type="number" class="rt-count" value="60" placeholder="Ø§Ù„Ø¹Ø¯Ø¯">
                    <button type="button" class="btn btn-danger remove-rt">Ã—</button>
                </div>
                <div class="room-type-row">
                    <input type="text" class="rt-name" value="Ø¬Ù†Ø§Ø­ Ø±Ø¨Ø§Ø¹ÙŠ" placeholder="Ø§Ù„Ù†ÙˆØ¹">
                    <input type="number" class="rt-count" value="40" placeholder="Ø§Ù„Ø¹Ø¯Ø¯">
                    <button type="button" class="btn btn-danger remove-rt">Ã—</button>
                </div>
            </div>
            <button type="button" class="btn btn-success" id="addRoomBtn">+ Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹</button>

            <h3 style="margin: 20px 0 15px; font-size: 1.1rem; color: var(--dark-blue); font-weight: 700;">ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3>
            <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 15px; background: var(--light-blue); padding: 10px; border-radius: 8px; border-right: 4px solid var(--dark-blue);">
                <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ± Ù„ØªÙ†Ø§Ø³Ø¨ Ø¸Ø±ÙˆÙ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙÙ†Ø¯Ù‚Ùƒ. Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙŠØ¹Ù†ÙŠ Ø³Ø¹Ø± Ø£Ø¹Ù„Ù‰ ÙÙŠ Ø§Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„.
            </p>
            <div class="form-grid">
                <div class="form-group">
                    <label>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø­Ø¬</label>
                    <input type="number" id="hajjMultiplier" value="4.0" step="0.1" min="1.0">
                </div>
                <div class="form-group">
                    <label>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¹Ø´Ø± Ø§Ù„Ø£ÙˆØ§Ø®Ø±</label>
                    <input type="number" id="lastTenMultiplier" value="3.5" step="0.1" min="1.0">
                </div>
                <div class="form-group">
                    <label>Ù…Ø¹Ø§Ù…Ù„ Ø±Ù…Ø¶Ø§Ù†</label>
                    <input type="number" id="ramadanMultiplier" value="2.0" step="0.1" min="1.0">
                </div>
                <div class="form-group">
                    <label>Ù…Ø¹Ø§Ù…Ù„ Ø°Ø±ÙˆØ© Ø§Ù„Ø¹Ù…Ø±Ø©</label>
                    <input type="number" id="umrahPeakMultiplier" value="1.8" step="0.1" min="1.0">
                </div>
                <div class="form-group">
                    <label>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø´ØªØ§Ø¡</label>
                    <input type="number" id="winterMultiplier" value="1.5" step="0.1" min="1.0">
                </div>
                <div class="form-group">
                    <label>Ù…Ø¹Ø§Ù…Ù„ Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                    <input type="number" id="weekendMultiplier" value="1.3" step="0.1" min="1.0">
                </div>
            </div>
            
            <div style="margin: 15px 0;">
                <button type="button" class="btn btn-success" id="resetMultipliersBtn">ğŸ”„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</button>
            </div>

            <button type="submit" class="btn btn-primary" id="analyzeBtn">ğŸš€ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø³Ø¹Ø±ÙŠØ© <span id="yearDisplay">2026</span></button>
        </form>
    </div>

    <div id="resultsArea" class="hidden">
        
        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (AI)</div>
                <div class="stat-value" id="totalRevenueDisplay">0</div>
                <div class="stat-label" style="color: var(--green);">+32% Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ù…Ø§Ø¶ÙŠ</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±)</div>
                <div class="stat-value" style="color: var(--green);" id="netProfitDisplay">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
                <div class="stat-value" id="newMarginDisplay">0%</div>
                <div class="profit-badge" id="marginImprovement">ØªØ­Ø³Ù† Ø¨Ù†Ø³Ø¨Ø© +8.2% â¬†</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ø´ØºØ§Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ</div>
                <div class="stat-value" id="occupancyDisplay">0%</div>
                <div class="stat-label" style="color: var(--orange);">+15% ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ø£Ø¹Ù„Ù‰ Ø¥ÙŠØ±Ø§Ø¯ ÙŠÙˆÙ…ÙŠ</div>
                <div class="stat-value" id="maxDailyRevenueDisplay">0</div>
                <div class="stat-label" style="color: var(--red);">ÙÙŠ Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„ØºØ±ÙØ© (ADR)</div>
                <div class="stat-value" id="avgDailyRateDisplay">0</div>
                <div class="stat-label" style="color: var(--blue);">Ù…Ø¹Ø¯Ù„ Ù…Ø±Ø¬Ø­ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ³Ù…</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„ÙŠØ§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©</div>
                <div class="stat-value" id="totalBookedNightsDisplay">0</div>
                <div class="stat-label" style="color: var(--green);">Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ù„ÙƒÙ„ ØºØ±ÙØ© Ù…ØªØ§Ø­Ø© (RevPAR)</div>
                <div class="stat-value" id="revParDisplay">0</div>
                <div class="stat-label" style="color: var(--dark-blue);">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ù„ÙƒÙ„ ØºØ±ÙØ©</div>
            </div>
        </div>

        <div class="legend-container">
            <div class="legend-item"><div class="dot" style="background:#f39c12;"></div>Ø±Ù…Ø¶Ø§Ù† (Ø¹Ø§Ø¯ÙŠ)</div>
            <div class="legend-item"><div class="dot" style="background:#e74c3c;"></div>Ø§Ù„Ø¹Ø´Ø± Ø§Ù„Ø£ÙˆØ§Ø®Ø±</div>
            <div class="legend-item"><div class="dot" style="background:#c0392b;"></div>Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬</div>
            <div class="legend-item"><div class="dot" style="background:#8e44ad;"></div>Ø°Ø±ÙˆØ© Ø§Ù„Ø¹Ù…Ø±Ø©</div>
            <div class="legend-item"><div class="dot" style="background:#3498db;"></div>ÙØªØ±Ø© Ø§Ù„Ø´ØªØ§Ø¡</div>
            <div class="legend-item"><div class="dot" style="background:#f1c40f;"></div>Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹</div>
            <div class="legend-item"><div class="dot" style="background:#ffffff; border:1px solid #dee2e6;"></div>Ø£ÙŠØ§Ù… Ø¹Ø§Ø¯ÙŠØ©</div>
        </div>

        <div style="text-align: left; margin-top: 15px;">
            <button class="btn export-btn" id="exportBtn">
                <span>ğŸ“¥</span> ØªØµØ¯ÙŠØ± Ù…Ù„Ù Excel Ø´Ø§Ù…Ù„
            </button>
        </div>

        <div style="margin-top: 30px;">
            <h3 style="color: var(--dark-blue); font-size: 1.3rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <span>ğŸ“ˆ</span> ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ
            </h3>
            <div style="background: var(--card-bg); padding: 20px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid var(--border);">
                <canvas id="revenueChart" height="300"></canvas>
            </div>
        </div>

        <div class="month-grid" id="calendarGrid" style="margin-top: 30px;"></div>
    </div>
</div>

<div class="modal" id="dayModal">
    <div class="modal-content" style="max-width: 600px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 id="modalDateTitle" style="color:var(--dark-blue); font-size: 1.4rem;"></h3>
            <button class="close-modal" onclick="closeModal('dayModal')">Ã—</button>
        </div>
        <p id="modalSeasonInfo" style="margin-bottom:15px; color: var(--gray); background: var(--light-blue); padding: 10px; border-radius: 8px; border-left: 3px solid var(--dark-blue);"></p>
        
        <div class="table-responsive">
            <table style="font-size:0.95rem;">
                <thead>
                    <tr>
                        <th>Ù†ÙˆØ¹ Ø§Ù„ØºØ±ÙØ©</th>
                        <th>Ø§Ù„Ø³Ø¹Ø± (Ø¹Ø§Ø¯ÙŠ)</th>
                        <th>Ø³Ø¹Ø± Ø§Ù„Ø¥Ø·Ù„Ø§Ù„Ø© (+40%)</th>
                        <th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯</th>
                    </tr>
                </thead>
                <tbody id="dayModalBody"></tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal" id="monthModal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items: center; margin-bottom: 20px;">
            <h2 id="monthModalTitle" style="color:var(--dark-blue); font-size: 1.6rem;"></h2>
            <button class="close-modal" onclick="closeModal('monthModal')">Ã—</button>
        </div>
        <div class="table-responsive" style="max-height: 70vh;">
            <table id="monthTable">
                <thead style="position: sticky; top: 0; background: white; z-index: 10;">
                    <tr id="monthTableHead"></tr>
                </thead>
                <tbody id="monthTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const state = {
        hotelInfo: {},
        roomTypes: [],
        yearlyData: [],
        months: ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±']
    };

    function getSeasonDates(year) {
        // Approximate Hijri to Gregorian conversion for major Islamic events
        // These dates shift approximately 11 days earlier each year
        const baseYear = 2026;
        const yearDiff = year - baseYear;
        const dayShift = yearDiff * 11; // Approximate
        
        // Base dates for 2026
        const baseRamadanStart = new Date(2026, 1, 18); // Feb 18
        const baseLastTenStart = new Date(2026, 2, 9);  // Mar 9
        const baseRamadanEnd = new Date(2026, 2, 19);   // Mar 19
        const baseHajjStart = new Date(2026, 4, 15);    // May 15
        const baseHajjEnd = new Date(2026, 4, 25);      // May 25
        
        // Adjust dates based on year difference
        const ramadanStart = new Date(baseRamadanStart.getFullYear(), baseRamadanStart.getMonth(), baseRamadanStart.getDate() - dayShift);
        ramadanStart.setFullYear(year);
        
        const lastTenStart = new Date(baseLastTenStart.getFullYear(), baseLastTenStart.getMonth(), baseLastTenStart.getDate() - dayShift);
        lastTenStart.setFullYear(year);
        
        const ramadanEnd = new Date(baseRamadanEnd.getFullYear(), baseRamadanEnd.getMonth(), baseRamadanEnd.getDate() - dayShift);
        ramadanEnd.setFullYear(year);
        
        const hajjStart = new Date(baseHajjStart.getFullYear(), baseHajjStart.getMonth(), baseHajjStart.getDate() - dayShift);
        hajjStart.setFullYear(year);
        
        const hajjEnd = new Date(baseHajjEnd.getFullYear(), baseHajjEnd.getMonth(), baseHajjEnd.getDate() - dayShift);
        hajjEnd.setFullYear(year);
        
        // Fixed dates that don't depend on Hijri calendar
        const umrahPeakStart = new Date(year, 7, 1);   // Aug 1 (summer peak)
        const umrahPeakEnd = new Date(year, 8, 30);    // Sep 30
        const winterHighStart = new Date(year, 11, 1); // Dec 1 (winter tourism)
        const winterHighEnd = new Date(year, 2, 1);    // Mar 1 (before Ramadan)
        
        return {
            ramadanStart,
            lastTenStart,
            ramadanEnd,
            hajjStart,
            hajjEnd,
            umrahPeakStart,
            umrahPeakEnd,
            winterHighStart,
            winterHighEnd
        };
    }

    // Listeners
    document.getElementById('addRoomBtn').addEventListener('click', () => {
        const div = document.createElement('div');
        div.className = 'room-type-row';
        div.innerHTML = `<input type="text" class="rt-name" placeholder="Ø§Ù„Ù†ÙˆØ¹"><input type="number" class="rt-count" placeholder="Ø§Ù„Ø¹Ø¯Ø¯"><button type="button" class="btn btn-danger remove-rt">Ã—</button>`;
        document.getElementById('roomTypesContainer').appendChild(div);
    });

    document.getElementById('roomTypesContainer').addEventListener('click', e => {
        if(e.target.classList.contains('remove-rt')) e.target.parentElement.remove();
    });

    document.getElementById('hotelForm').addEventListener('submit', e => {
        e.preventDefault();
        runAnalysis();
    });

    document.getElementById('exportBtn').addEventListener('click', exportExcel);
    
    document.getElementById('resetMultipliersBtn').addEventListener('click', resetMultipliers);
    
    // Update year display when selection changes
    document.getElementById('analysisYear').addEventListener('change', function() {
        document.getElementById('yearDisplay').textContent = this.value;
    });

    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    
    function resetMultipliers() {
        document.getElementById('hajjMultiplier').value = 4.0;
        document.getElementById('lastTenMultiplier').value = 3.5;
        document.getElementById('ramadanMultiplier').value = 2.0;
        document.getElementById('umrahPeakMultiplier').value = 1.8;
        document.getElementById('winterMultiplier').value = 1.5;
        document.getElementById('weekendMultiplier').value = 1.3;
    }

    // --- Core Analysis Logic ---
    function runAnalysis() {
        // 1. Gather Inputs
        state.hotelInfo = {
            name: document.getElementById('hotelName').value,
            totalRooms: Number(document.getElementById('totalRooms').value),
            viewRooms: Number(document.getElementById('viewRooms').value),
            basePrice: Number(document.getElementById('basePrice').value),
            rent: Number(document.getElementById('annualRent').value),
            currentMargin: Number(document.getElementById('currentProfitMargin').value),
            multipliers: {
                hajj: parseFloat(document.getElementById('hajjMultiplier').value),
                lastTen: parseFloat(document.getElementById('lastTenMultiplier').value),
                ramadan: parseFloat(document.getElementById('ramadanMultiplier').value),
                umrahPeak: parseFloat(document.getElementById('umrahPeakMultiplier').value),
                winter: parseFloat(document.getElementById('winterMultiplier').value),
                weekend: parseFloat(document.getElementById('weekendMultiplier').value)
            }
        };

        state.roomTypes = [];
        document.querySelectorAll('.room-type-row').forEach(row => {
            const name = row.querySelector('.rt-name').value;
            const count = Number(row.querySelector('.rt-count').value);
            if(name && count) state.roomTypes.push({ name, count });
        });

        if(state.roomTypes.length === 0) { alert('Ø£Ø¶Ù Ù†ÙˆØ¹ ØºØ±ÙØ© ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'); return; }

        // 2. Generate Data
        state.yearlyData = generateMakkahData();

        // 3. Render
        renderStats();
        renderCalendar();
        renderRevenueChart();
        
        document.getElementById('resultsArea').classList.remove('hidden');
        document.getElementById('resultsArea').scrollIntoView({behavior:'smooth'});
    }

    function generateMakkahData() {
        const data = [];
        const analysisYear = parseInt(document.getElementById('analysisYear').value);
        const seasonDates = getSeasonDates(analysisYear);
        const viewRatio = state.hotelInfo.viewRooms / state.hotelInfo.totalRooms; // % of rooms with view

        for (let m = 0; m < 12; m++) {
            const daysInMonth = new Date(analysisYear, m + 1, 0).getDate();
            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(analysisYear, m, d);
                const dayOfWeek = date.getDay();
                const isWeekend = (dayOfWeek === 5 || dayOfWeek === 6); // Fri/Sat
                
                let season = "Ø¹Ø§Ø¯ÙŠ";
                let multiplier = 1.0;
                let cssClass = "";

                // Logic for Seasons
                if (date >= seasonDates.ramadanStart && date <= seasonDates.ramadanEnd) {
                    if (date >= seasonDates.lastTenStart) {
                        season = "Ø§Ù„Ø¹Ø´Ø± Ø§Ù„Ø£ÙˆØ§Ø®Ø±";
                        multiplier = state.hotelInfo.multipliers.lastTen;
                        cssClass = "day-last10";
                    } else {
                        season = "Ø±Ù…Ø¶Ø§Ù†";
                        multiplier = state.hotelInfo.multipliers.ramadan;
                        cssClass = "day-ramadan";
                    }
                } else if (date >= seasonDates.hajjStart && date <= seasonDates.hajjEnd) {
                    season = "Ø­Ø¬";
                    multiplier = state.hotelInfo.multipliers.hajj;
                    cssClass = "day-hajj";
                } else if (date >= seasonDates.umrahPeakStart && date <= seasonDates.umrahPeakEnd) {
                    season = "Ø°Ø±ÙˆØ© Ø§Ù„Ø¹Ù…Ø±Ø©";
                    multiplier = state.hotelInfo.multipliers.umrahPeak;
                    cssClass = "day-umrah-peak";
                } else if (date >= seasonDates.winterHighStart || date <= seasonDates.winterHighEnd) {
                    season = "ÙØªØ±Ø© Ø§Ù„Ø´ØªØ§Ø¡";
                    multiplier = state.hotelInfo.multipliers.winter;
                    cssClass = "day-winter";
                } else if (isWeekend) {
                    season = "Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹";
                    multiplier = state.hotelInfo.multipliers.weekend;
                    cssClass = "day-weekend";
                }

                // Calculate Day Metrics
                let dailyRev = 0;
                const roomData = [];

                state.roomTypes.forEach((rt, idx) => {
                    let typeBasePrice = state.hotelInfo.basePrice * (1 + (idx * 0.3));
                    let finalPrice = Math.round(typeBasePrice * multiplier);
                    
                    let occ = 60;
                    if(season.includes("Ø±Ù…Ø¶Ø§Ù†") || season.includes("Ø­Ø¬")) occ = 95;
                    else if(isWeekend) occ = 75;
                    
                    const viewCount = Math.round(rt.count * viewRatio);
                    const standardCount = rt.count - viewCount;
                    const viewPrice = Math.round(finalPrice * 1.4);
                    
                    const typeRev = (standardCount * finalPrice * (occ/100)) + (viewCount * viewPrice * (occ/100));
                    
                    roomData.push({
                        name: rt.name,
                        stdPrice: finalPrice,
                        viewPrice: viewPrice,
                        occ: occ,
                        rev: Math.round(typeRev)
                    });
                    
                    dailyRev += typeRev;
                });

                data.push({
                    date: date,
                    monthIndex: m,
                    day: d,
                    season: season,
                    multiplier: multiplier,
                    cssClass: cssClass,
                    rooms: roomData,
                    totalRev: Math.round(dailyRev)
                });
            }
        }
        return data;
    }

    function renderStats() {
        const totalRev = state.yearlyData.reduce((a, b) => a + b.totalRev, 0);
        const rent = state.hotelInfo.rent;
        const opsCost = totalRev * 0.20; 
        const netProfit = totalRev - rent - opsCost;
        const netMargin = (netProfit / totalRev) * 100;
        
        // Calculate additional metrics
        const maxDailyRev = Math.max(...state.yearlyData.map(d => d.totalRev));
        const totalOccupancyDays = state.yearlyData.reduce((sum, day) => sum + (day.rooms[0].occ / 100), 0);
        const avgOccupancy = (totalOccupancyDays / 365) * 100;
        const totalBookedNights = state.yearlyData.reduce((sum, day) => {
            return sum + (state.hotelInfo.totalRooms * (day.rooms[0].occ / 100));
        }, 0);
        const avgDailyRate = totalRev / totalBookedNights;
        const revPar = totalRev / (state.hotelInfo.totalRooms * 365);

        document.getElementById('totalRevenueDisplay').textContent = (totalRev/1000000).toFixed(2) + " Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„";
        document.getElementById('netProfitDisplay').textContent = (netProfit/1000000).toFixed(2) + " Ù…Ù„ÙŠÙˆÙ† Ø±ÙŠØ§Ù„";
        document.getElementById('newMarginDisplay').textContent = netMargin.toFixed(1) + "%";
        
        const diff = netMargin - state.hotelInfo.currentMargin;
        const badge = document.getElementById('marginImprovement');
        badge.textContent = diff > 0 ? `ØªØ­Ø³Ù† Ø¨Ù†Ø³Ø¨Ø© +${diff.toFixed(1)}% â¬†` : `Ø§Ù†Ø®ÙØ§Ø¶ ${diff.toFixed(1)}%`;
        badge.style.color = diff > 0 ? 'var(--green)' : 'var(--red)';
        
        document.getElementById('occupancyDisplay').textContent = Math.round(avgOccupancy) + "%";
        document.getElementById('maxDailyRevenueDisplay').textContent = maxDailyRev.toLocaleString() + " Ø±ÙŠØ§Ù„";
        document.getElementById('avgDailyRateDisplay').textContent = Math.round(avgDailyRate).toLocaleString() + " Ø±ÙŠØ§Ù„";
        document.getElementById('totalBookedNightsDisplay').textContent = Math.round(totalBookedNights).toLocaleString();
        document.getElementById('revParDisplay').textContent = Math.round(revPar).toLocaleString() + " Ø±ÙŠØ§Ù„";
    }

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = '';

        state.months.forEach((mName, mIdx) => {
            const card = document.createElement('div');
            card.className = 'month-card';
            
            const header = document.createElement('div');
            header.className = 'month-header';
            header.innerHTML = `<span>${mName}</span><span>ğŸ” ØªÙØ§ØµÙŠÙ„</span>`;
            header.onclick = () => openMonthModal(mIdx);
            
            const daysDiv = document.createElement('div');
            daysDiv.className = 'days-container';

            const days = state.yearlyData.filter(d => d.monthIndex === mIdx);
            const firstDay = days[0].date.getDay();
            for(let i=0; i<firstDay; i++) {
                const empty = document.createElement('div');
                empty.style.backgroundColor = 'transparent';
                empty.style.border = 'none';
                daysDiv.appendChild(empty);
            }

            days.forEach(d => {
                // Apply Heatmap Logic - Map multiplier to demand level
                let demandLevel;
                if (d.multiplier >= 4.0) {
                    demandLevel = 'very-high';
                } else if (d.multiplier >= 2.5) {
                    demandLevel = 'high';
                } else if (d.multiplier >= 1.5) {
                    demandLevel = 'medium';
                } else {
                    demandLevel = 'neutral';
                }
                
                const cell = document.createElement('div');
                cell.className = `day-cell ${d.cssClass} heat-${demandLevel}`;
                cell.textContent = d.day;
                cell.title = `${d.season} - Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯: ${d.totalRev.toLocaleString()} Ø±ÙŠØ§Ù„`;
                cell.onclick = (e) => { e.stopPropagation(); openDayModal(d); };
                daysDiv.appendChild(cell);
            });

            card.append(header, daysDiv);
            grid.appendChild(card);
        });
    }

    function renderRevenueChart() {
        const ctx = document.getElementById('revenueChart').getContext('2d');
        
        // Group data by month
        const monthlyData = state.months.map((month, index) => {
            const monthDays = state.yearlyData.filter(d => d.monthIndex === index);
            return monthDays.reduce((sum, day) => sum + day.totalRev, 0);
        });
        
        // Destroy existing chart if it exists
        if (window.revenueChartInstance) {
            window.revenueChartInstance.destroy();
        }
        
        // Create new chart
        window.revenueChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: state.months,
                datasets: [{
                    label: 'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±ÙŠØ§Ù„)',
                    data: monthlyData,
                    backgroundColor: 'rgba(10, 46, 90, 0.7)',
                    borderColor: 'rgba(10, 46, 90, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø£Ø´Ù‡Ø± 2026'
                    },
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString() + ' Ø±.Ø³';
                            }
                        }
                    },
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });
    }

    function openDayModal(d) {
        const analysisYear = document.getElementById('analysisYear').value;
        document.getElementById('modalDateTitle').textContent = `${d.day} ${state.months[d.monthIndex]} ${analysisYear} (${d.season})`;
        document.getElementById('modalSeasonInfo').textContent = `Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø³Ø¹Ø±: x${d.multiplier} | Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„: ${d.rooms[0].occ}% | Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ: ${d.totalRev.toLocaleString()} Ø±ÙŠØ§Ù„`;
        
        const tbody = document.getElementById('dayModalBody');
        tbody.innerHTML = '';
        d.rooms.forEach(r => {
            tbody.innerHTML += `
                <tr>
                    <td style="font-weight:600; color:var(--dark-blue)">${r.name}</td>
                    <td>${r.stdPrice.toLocaleString()} Ø±ÙŠØ§Ù„</td>
                    <td style="color:var(--orange); font-weight:600">${r.viewPrice.toLocaleString()} Ø±ÙŠØ§Ù„</td>
                    <td style="color:var(--green); font-weight:700">${r.rev.toLocaleString()} Ø±ÙŠØ§Ù„</td>
                </tr>`;
        });
        document.getElementById('dayModal').classList.add('active');
    }

    function openMonthModal(mIdx) {
        const analysisYear = document.getElementById('analysisYear').value;
        document.getElementById('monthModalTitle').textContent = `ØªÙØ§ØµÙŠÙ„ Ø´Ù‡Ø± ${state.months[mIdx]} ${analysisYear}`;
        const days = state.yearlyData.filter(d => d.monthIndex === mIdx);
        
        let headHTML = `<th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</th>`;
        state.roomTypes.forEach(rt => {
             headHTML += `<th>${rt.name} (Ø¹Ø§Ø¯ÙŠ)</th><th>${rt.name} (Ø¥Ø·Ù„Ø§Ù„Ø©)</th>`; 
        });
        headHTML += `<th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ</th>`;
        document.getElementById('monthTableHead').innerHTML = headHTML;

        let bodyHTML = '';
        days.forEach(d => {
            let row = `<tr>
                <td style="font-weight:600">${d.day}</td>
                <td style="color:${d.multiplier > 1.5 ? 'var(--dark-blue)' : 'inherit'}; font-weight:${d.multiplier > 1.5 ? '600' : 'normal'}">${d.season}</td>`;
            
            d.rooms.forEach(r => {
                row += `<td>${r.stdPrice.toLocaleString()}</td><td style="color:var(--orange)">${r.viewPrice.toLocaleString()}</td>`;
            });
            
            row += `<td style="font-weight:bold; color:var(--green)">${d.totalRev.toLocaleString()} Ø±ÙŠØ§Ù„</td></tr>`;
            bodyHTML += row;
        });
        document.getElementById('monthTableBody').innerHTML = bodyHTML;
        document.getElementById('monthModal').classList.add('active');
    }

    function exportExcel() {
        const wb = XLSX.utils.book_new();
        
        const analysisYear = document.getElementById('analysisYear').value;
        const summaryData = [
            [`ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙ†Ø¯Ù‚ Ø§Ù„Ù…Ø§Ù„ÙŠ - Ù…ÙƒØ© ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø© ${analysisYear}`],
            ["Ø§Ø³Ù… Ø§Ù„ÙÙ†Ø¯Ù‚", state.hotelInfo.name],
            ["Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø³Ù†ÙˆÙŠ", state.hotelInfo.rent.toLocaleString() + " Ø±ÙŠØ§Ù„"],
            ["Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹", document.getElementById('totalRevenueDisplay').textContent],
            ["ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹", document.getElementById('netProfitDisplay').textContent],
            ["Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", document.getElementById('newMarginDisplay').textContent],
            ["Ø¹Ø¯Ø¯ ØºØ±Ù Ø§Ù„Ø¥Ø·Ù„Ø§Ù„Ø©", state.hotelInfo.viewRooms],
            ["Ø£Ø¹Ù„Ù‰ Ø¥ÙŠØ±Ø§Ø¯ ÙŠÙˆÙ…ÙŠ", document.getElementById('maxDailyRevenueDisplay').textContent],
            ["Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„ØºØ±ÙØ© (ADR)", document.getElementById('avgDailyRateDisplay').textContent],
            ["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„ÙŠØ§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©", document.getElementById('totalBookedNightsDisplay').textContent],
            ["Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ù„ÙƒÙ„ ØºØ±ÙØ© Ù…ØªØ§Ø­Ø© (RevPAR)", document.getElementById('revParDisplay').textContent],
            [""],
            ["Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„"],
            ["Ø§Ù„Ø³Ù†Ø© Ù…Ø­Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„", analysisYear],
            [""],
            ["Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù…Ø®ØµØµØ©"],
            ["Ø§Ù„Ø­Ø¬", state.hotelInfo.multipliers.hajj],
            ["Ø§Ù„Ø¹Ø´Ø± Ø§Ù„Ø£ÙˆØ§Ø®Ø±", state.hotelInfo.multipliers.lastTen],
            ["Ø±Ù…Ø¶Ø§Ù†", state.hotelInfo.multipliers.ramadan],
            ["Ø°Ø±ÙˆØ© Ø§Ù„Ø¹Ù…Ø±Ø©", state.hotelInfo.multipliers.umrahPeak],
            ["Ø§Ù„Ø´ØªØ§Ø¡", state.hotelInfo.multipliers.winter],
            ["Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹", state.hotelInfo.multipliers.weekend]
        ];
        XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(summaryData), "Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ");

        const headers = ["Ø§Ù„ØªØ§Ø±ÙŠØ®", "Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©"];
        state.roomTypes.forEach(rt => { 
            headers.push(`${rt.name} Ø³Ø¹Ø± Ø¹Ø§Ø¯ÙŠ`);
            headers.push(`${rt.name} Ø³Ø¹Ø± Ø¥Ø·Ù„Ø§Ù„Ø©`); 
        });
        headers.push("Ø§Ù„Ø¥Ø´ØºØ§Ù„ %", "Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ (Ø±ÙŠØ§Ù„)");
        
        const rows = [headers];
        const analysisYear = document.getElementById('analysisYear').value;
        state.yearlyData.forEach(d => {
            const row = [`${d.day}/${d.monthIndex+1}/${analysisYear}`, d.season];
            d.rooms.forEach(r => { 
                row.push(r.stdPrice.toLocaleString());
                row.push(r.viewPrice.toLocaleString());
            });
            row.push(d.rooms[0].occ + "%", d.totalRev.toLocaleString());
            rows.push(row);
        });
        
        XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(rows), "Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±");
        const analysisYear = document.getElementById('analysisYear').value;
        XLSX.writeFile(wb, `Haram_Hotel_Plan_${analysisYear}.xlsx`);
    }
</script>
</body>
</html>
